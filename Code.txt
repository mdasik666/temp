from bs4 import BeautifulSoup
import json

def parse_html(html_content):
    return BeautifulSoup(html_content, 'html.parser')

def compare_elements(issue_element, correct_element, path=""):
    differences = []

    # Compare tag names
    if issue_element.name != correct_element.name:
        differences.append({
            "type": "tag_mismatch",
            "path": path,
            "message": f"Tag mismatch: '{issue_element.name}' vs '{correct_element.name}'"
        })
        return differences

    # Compare attributes (report only differences in issue file)
    if issue_element.attrs != correct_element.attrs:
        differences.append({
            "type": "attribute_mismatch",
            "path": path,
            "message": f"Attribute mismatch in issue file: {issue_element.attrs}"
        })

    # Recursively compare child elements
    issue_children = [child for child in issue_element.children if child.name]
    correct_children = [child for child in correct_element.children if child.name]

    max_len = max(len(issue_children), len(correct_children))
    for i in range(max_len):
        new_path = f"{path}/{issue_element.name}[{i}]"
        
        if i < len(issue_children) and i < len(correct_children):
            # Compare corresponding child elements
            differences.extend(compare_elements(issue_children[i], correct_children[i], new_path))
        elif i < len(issue_children):
            # Extra element in issue file (added element)
            differences.append({
                "type": "added",
                "path": new_path,
                "message": f"Extra element in issue file: '{issue_children[i].name}'"
            })
        else:
            # Missing element in issue file (deleted element)
            differences.append({
                "type": "deleted",
                "path": new_path,
                "message": f"Element '{correct_children[i].name}' is missing in issue file"
            })

    return differences

# Example usage
html1 = '<div><p class="text">Hello</p><span>Extra</span></div>'  # Issue file (Incorrect)
html2 = '<div><p class="text"></p></div>'  # Correct file

soup1 = parse_html(html1)
soup2 = parse_html(html2)

differences = compare_elements(soup1, soup2)

# Output differences as JSON
json_report = json.dumps(differences, indent=4)
print(json_report)
