import difflib
from bs4 import BeautifulSoup

def compare_html(file1, file2, output_file):
    # Read both HTML files
    with open(file1, 'r', encoding='utf-8') as f1, open(file2, 'r', encoding='utf-8') as f2:
        html1 = f1.read()
        html2 = f2.read()

    # Parse the HTML files with BeautifulSoup
    soup1 = BeautifulSoup(html1, 'html.parser')
    soup2 = BeautifulSoup(html2, 'html.parser')

    # Extract text from the HTML, preserving structure
    text1 = soup1.prettify()
    text2 = soup2.prettify()

    # Generate a diff using difflib
    diff = difflib.ndiff(text1.splitlines(), text2.splitlines())

    # Highlight changes in HTML
    highlighted_html = ""
    for line in diff:
        if line.startswith('- '):  # Line present only in file1
            highlighted_html += f"<span style='background-color: red;'>{line[2:]}</span>\n"
        elif line.startswith('+ '):  # Line present only in file2
            highlighted_html += f"<span style='background-color: green;'>{line[2:]}</span>\n"
        elif line.startswith('? '):  # Line shows differences within the same line
            continue
        else:  # Unchanged line
            highlighted_html += line[2:] + "\n"

    # Wrap highlighted content in an HTML structure
    result_html = f"""
    <!DOCTYPE html>
    <html>
    <head>
        <title>HTML Comparison</title>
    </head>
    <body>
        <pre>{highlighted_html}</pre>
    </body>
    </html>
    """

    # Write the result to a new HTML file
    with open(output_file, 'w', encoding='utf-8') as output:
        output.write(result_html)

# Usage
file1 = 'file1.html'  # Path to the first HTML file
file2 = 'file2.html'  # Path to the second HTML file
output_file = 'output.html'  # Path to save the highlighted HTML

compare_html(file1, file2, output_file)
